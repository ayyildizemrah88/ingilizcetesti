{% extends "base.html" %}

{% block title %}Aday Detayı - {{ aday.ad_soyad }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0">
                    <a href="{{ url_for('admin.adaylar') }}" class="text-decoration-none text-muted">
                        ← Geri
                    </a>
                </h4>
                <div>
                    <a href="{{ url_for('admin.aday_duzenle', id=aday.id) }}" class="btn btn-outline-primary">
                        Düzenle
                    </a>
                </div>
            </div>
            
            <!-- Kişi Bilgileri -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Kişi Bilgileri</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Ad Soyad:</strong> {{ aday.ad_soyad }}</p>
                            <p><strong>Email:</strong> {{ aday.email }}</p>
                            <p><strong>TC Kimlik:</strong> {{ aday.tc_kimlik or '-' }}</p>
                            <p><strong>Telefon:</strong> {{ aday.cep_no or '-' }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Giriş Kodu:</strong> <code>{{ aday.giris_kodu }}</code></p>
                            <p><strong>Sınav Kodu:</strong> <code>{{ aday.exam_code or '-' }}</code></p>
                            <p>
                                <strong>Durum:</strong> 
                                {% set durum = aday.durum or aday.sinav_durumu or 'beklemede' %}
                                {% if durum == 'tamamlandi' %}
                                <span class="badge bg-success">Tamamlandı</span>
                                {% elif durum == 'sinavda' %}
                                <span class="badge bg-warning">Sınavda</span>
                                {% else %}
                                <span class="badge bg-secondary">Beklemede</span>
                                {% endif %}
                            </p>
                            <p><strong>Şirket:</strong> {{ aday.company.ad if aday.company else '-' }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sınav Sonuçları -->
            {% if aday.durum == 'tamamlandi' or aday.toplam_puan %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Sınav Sonuçları</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <h2 class="display-4 text-primary">{{ aday.toplam_puan or aday.puan or 0 }}%</h2>
                            <p class="text-muted">Toplam Puan</p>
                        </div>
                        <div class="col-md-4 text-center">
                            <h2 class="display-4 text-success">{{ aday.cefr_seviye or aday.seviye_sonuc or '-' }}</h2>
                            <p class="text-muted">CEFR Seviye</p>
                        </div>
                        <div class="col-md-4 text-center">
                            <h2 class="display-4 text-info">{{ aday.trust_score or 100 }}%</h2>
                            <p class="text-muted">Güven Skoru</p>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <h6>Kategori Bazlı Performans</h6>
                    <div class="row mt-3">
                        <div class="col-md-4 mb-3">
                            <label>Grammar</label>
                            <div class="progress">
                                <div class="progress-bar bg-primary" style="width: {{ aday.grammar_puan or aday.p_grammar or 0 }}%">
                                    {{ aday.grammar_puan or aday.p_grammar or 0 }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label>Vocabulary</label>
                            <div class="progress">
                                <div class="progress-bar bg-success" style="width: {{ aday.vocabulary_puan or aday.p_vocabulary or 0 }}%">
                                    {{ aday.vocabulary_puan or aday.p_vocabulary or 0 }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label>Reading</label>
                            <div class="progress">
                                <div class="progress-bar bg-info" style="width: {{ aday.reading_puan or aday.p_reading or 0 }}%">
                                    {{ aday.reading_puan or aday.p_reading or 0 }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label>Listening</label>
                            <div class="progress">
                                <div class="progress-bar bg-warning" style="width: {{ aday.listening_puan or aday.p_listening or 0 }}%">
                                    {{ aday.listening_puan or aday.p_listening or 0 }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label>Writing</label>
                            <div class="progress">
                                <div class="progress-bar bg-danger" style="width: {{ aday.writing_puan or aday.p_writing or 0 }}%">
                                    {{ aday.writing_puan or aday.p_writing or 0 }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label>Speaking</label>
                            <div class="progress">
                                <div class="progress-bar bg-secondary" style="width: {{ aday.speaking_puan or aday.p_speaking or 0 }}%">
                                    {{ aday.speaking_puan or aday.p_speaking or 0 }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Sınav Zaman Bilgileri -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Zaman Bilgileri</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <p><strong>Kayıt Tarihi:</strong> {{ aday.created_at.strftime('%d.%m.%Y %H:%M') if aday.created_at else '-' }}</p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>Sınav Başlangıç:</strong> {{ aday.sinav_baslama.strftime('%d.%m.%Y %H:%M') if aday.sinav_baslama else '-' }}</p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>Sınav Bitiş:</strong> {{ aday.sinav_bitis.strftime('%d.%m.%Y %H:%M') if aday.sinav_bitis else '-' }}</p>
                        </div>
                    </div>
                    {% if aday.is_paused %}
                    <div class="alert alert-warning mt-3">
                        <strong>Sınav Duraklatılmış!</strong> Aday sınavını duraklattı. Toplam duraklama sayısı: {{ aday.pause_count or 0 }}
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Cevaplar -->
            {% if aday.answers and aday.answers.count() > 0 %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Cevaplar ({{ aday.answers.count() }})</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Soru</th>
                                    <th>Cevap</th>
                                    <th>Doğru</th>
                                    <th>Süre</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for answer in aday.answers.limit(20) %}
                                <tr>
                                    <td>{{ loop.index }}</td>
                                    <td>{{ answer.question.soru_metni[:50] if answer.question else '-' }}...</td>
                                    <td>{{ answer.cevap }}</td>
                                    <td>
                                        {% if answer.dogru_mu %}
                                        <span class="text-success">✓</span>
                                        {% else %}
                                        <span class="text-danger">✗</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ answer.sure or '-' }}s</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Admin Notları -->
            {% if aday.admin_notes %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Admin Notları</h5>
                </div>
                <div class="card-body">
                    <p>{{ aday.admin_notes }}</p>
                </div>
            </div>
            {% endif %}
            
        </div>
    </div>
</div>

<!-- NEW: Include SuperAdmin Exam Reset Button -->
{% include 'partials/exam_reset_button.html' %}

{% endblock %}
