{% extends "base.html" %}
{% block title %}Veri Temizleme - Skills Test Center{% endblock %}
{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4"><i class="fas fa-broom text-warning me-2"></i>Veri Temizleme</h2>
        </div>
    </div>
    <div class="row">
        <!-- Statistics Cards -->
        <div class="col-md-4 mb-4">
            <div class="card bg-info text-white h-100">
                <div class="card-body text-center">
                    <h1 class="display-4">{{ stats.old_candidates or 0 }}</h1>
                    <p class="mb-0">90+ Gün Önceki Tamamlanmış Sınavlar</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card bg-warning text-dark h-100">
                <div class="card-body text-center">
                    <h1 class="display-4">{{ stats.deleted_candidates or 0 }}</h1>
                    <p class="mb-0">Silinmiş Adaylar (Soft Delete)</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card bg-secondary text-white h-100">
                <div class="card-body text-center">
                    <h1 class="display-4">{{ stats.old_logs or 0 }}</h1>
                    <p class="mb-0">180+ Gün Önceki Log Kayıtları</p>
                </div>
            </div>
        </div>
    </div>
    <!-- Cleanup Actions -->
    <div class="row mt-4">
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5><i class="fas fa-trash-alt text-danger me-2"></i>Silinmiş Adayları Temizle</h5>
                </div>
                <div class="card-body">
                    <p>Soft-delete edilmiş adayları ve ilişkili tüm verilerini kalıcı olarak siler.</p>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Dikkat:</strong> Bu işlem geri alınamaz!
                    </div>
                    <form method="POST" action="{{ url_for('data.execute_cleanup') }}"
                        onsubmit="return confirm('Bu işlem geri alınamaz! Devam etmek istiyor musunuz?')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="cleanup_type" value="deleted_candidates">
                        <button type="submit" class="btn btn-danger" {% if not stats.deleted_candidates %}disabled{%
                            endif %}>
                            <i class="fas fa-trash me-1"></i>Silinmiş Adayları Temizle ({{ stats.deleted_candidates or 0
                            }})
                        </button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5><i class="fas fa-file-alt text-secondary me-2"></i>Eski Logları Temizle</h5>
                </div>
                <div class="card-body">
                    <p>180 günden eski sistem log kayıtlarını siler.</p>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Loglar sistem performansı için düzenli olarak temizlenmelidir.
                    </div>
                    <form method="POST" action="{{ url_for('data.execute_cleanup') }}"
                        onsubmit="return confirm('Eski log kayıtları silinecek. Devam etmek istiyor musunuz?')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="cleanup_type" value="logs">
                        <button type="submit" class="btn btn-secondary" {% if not stats.old_logs %}disabled{% endif %}>
                            <i class="fas fa-eraser me-1"></i>Eski Logları Temizle ({{ stats.old_logs or 0 }})
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Navigation -->
    <div class="row mt-4">
        <div class="col-12">
            <a href="{{ url_for('data.backup') }}" class="btn btn-outline-primary me-2">
                <i class="fas fa-database me-1"></i>Yedekleme
            </a>
            <a href="{{ url_for('data.gdpr') }}" class="btn btn-outline-primary">
                <i class="fas fa-user-shield me-1"></i>GDPR / KVKK
            </a>
        </div>
    </div>
</div>
{% endblock %}
