{% extends "base.html" %}
{% block title %}SÄ±nav TamamlandÄ± - Skills Test Center{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Success Header -->
            <div class="text-center mb-5">
                <div class="mb-4">
                    {% if aday and aday.puan %}
                    {% if aday.puan >= 80 %}
                    <div class="display-1 mb-3">ğŸ†</div>
                    <h1 class="display-5 text-success">MÃ¼kemmel!</h1>
                    {% elif aday.puan >= 60 %}
                    <div class="display-1 mb-3">ğŸ‰</div>
                    <h1 class="display-5 text-primary">Tebrikler!</h1>
                    {% elif aday.puan >= 40 %}
                    <div class="display-1 mb-3">ğŸ‘</div>
                    <h1 class="display-5 text-info">Ä°yi Bir BaÅŸlangÄ±Ã§!</h1>
                    {% else %}
                    <div class="display-1 mb-3">ğŸ’ª</div>
                    <h1 class="display-5 text-warning">GeliÅŸtirebilirsiniz!</h1>
                    {% endif %}
                    {% else %}
                    <div class="display-1 mb-3">âœ…</div>
                    <h1 class="display-5 text-success">Tebrikler!</h1>
                    {% endif %}
                </div>
                <p class="lead text-muted">SÄ±navÄ±nÄ±z baÅŸarÄ±yla tamamlandÄ±.</p>
            </div>

            <!-- Score Cards -->
            <div class="row g-4 mb-5">
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm text-center h-100 bg-primary text-white">
                        <div class="card-body">
                            <h2 class="display-6 mb-1">{{ (aday.puan or 0)|round|int }}</h2>
                            <small class="opacity-75">Puan</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm text-center h-100 bg-success text-white">
                        <div class="card-body">
                            <h2 class="display-6 mb-1">{{ aday.seviye_sonuc or 'N/A' }}</h2>
                            <small class="opacity-75">CEFR Seviye</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm text-center h-100 bg-info text-white">
                        <div class="card-body">
                            <h2 class="display-6 mb-1">{{ aday.soru_limiti or 25 }}</h2>
                            <small class="opacity-75">Toplam Soru</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm text-center h-100 bg-warning text-dark">
                        <div class="card-body">
                            <h2 class="display-6 mb-1">{{ aday.sinav_suresi or 30 }} dk</h2>
                            <small class="opacity-75">SÃ¼re</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Performance -->
            {% if category_scores %}
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Kategori PerformansÄ±</h5>
                </div>
                <div class="card-body">
                    {% for cat, scores in category_scores.items() %}
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-capitalize">{{ cat }}</span>
                            <span class="text-muted">{{ scores.correct }}/{{ scores.total }}</span>
                        </div>
                        <div class="progress" style="height: 10px;">
                            {% set pct = ((scores.correct / scores.total) * 100) if scores.total > 0 else 0 %}
                            <div class="progress-bar {% if pct >= 70 %}bg-success{% elif pct >= 40 %}bg-warning{% else %}bg-danger{% endif %}"
                                style="width: {{ pct }}%"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- Skill Scores if no category_scores -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Yetenek PuanlarÄ±</h5>
                </div>
                <div class="card-body">
                    {% set skills = [
                    ('Grammar', aday.p_grammar),
                    ('Vocabulary', aday.p_vocabulary),
                    ('Reading', aday.p_reading),
                    ('Listening', aday.p_listening),
                    ('Writing', aday.p_writing),
                    ('Speaking', aday.p_speaking)
                    ] %}
                    {% for skill_name, skill_value in skills %}
                    {% if skill_value %}
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>{{ skill_name }}</span>
                            <span class="text-muted">%{{ (skill_value or 0)|round|int }}</span>
                        </div>
                        <div class="progress" style="height: 10px;">
                            {% set pct = skill_value or 0 %}
                            <div class="progress-bar {% if pct >= 70 %}bg-success{% elif pct >= 40 %}bg-warning{% else %}bg-danger{% endif %}"
                                style="width: {{ pct }}%"></div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Candidate Info -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="mb-0"><i class="fas fa-user me-2"></i>Aday Bilgileri</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Ad Soyad:</strong> {{ aday.ad_soyad or 'N/A' }}</p>
                            <p class="mb-2"><strong>GiriÅŸ Kodu:</strong> <code>{{ aday.giris_kodu or 'N/A' }}</code></p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>SÄ±nav Tarihi:</strong>
                                {% if aday.bitis_tarihi %}
                                {{ aday.bitis_tarihi.strftime('%d.%m.%Y %H:%M') }}
                                {% else %}
                                N/A
                                {% endif %}
                            </p>
                            <p class="mb-2"><strong>SÃ¼re:</strong> {{ aday.sinav_suresi or 30 }} dakika</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex flex-wrap gap-3 justify-content-center">
                        {% if aday and aday.certificate_hash %}
                        <a href="/certificate/{{ aday.certificate_hash }}" class="btn btn-success btn-lg">
                            <i class="fas fa-certificate me-2"></i>SertifikayÄ± GÃ¶rÃ¼ntÃ¼le
                        </a>
                        <a href="/certificate/{{ aday.certificate_hash }}/pdf" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-file-pdf me-2"></i>PDF Ä°ndir
                        </a>
                        {% endif %}
                        <a href="/" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-home me-2"></i>Ana Sayfa
                        </a>
                    </div>
                </div>
            </div>

            <!-- CEFR Level Explanation -->
            <div class="card border-0 bg-light mt-4">
                <div class="card-body">
                    <h6 class="card-title"><i class="fas fa-info-circle me-2"></i>CEFR Seviye AÃ§Ä±klamasÄ±</h6>
                    <p class="card-text small text-muted mb-0">
                        {% if aday.seviye_sonuc == 'C2' %}
                        <strong>C2 - Ustaca:</strong> Dili neredeyse anadil seviyesinde kullanabilirsiniz.
                        {% elif aday.seviye_sonuc == 'C1' %}
                        <strong>C1 - Ä°leri:</strong> KarmaÅŸÄ±k konularda akÄ±cÄ± ve spontan iletiÅŸim kurabilirsiniz.
                        {% elif aday.seviye_sonuc == 'B2' %}
                        <strong>B2 - Ãœst Orta:</strong> Kendi uzmanlÄ±k alanÄ±nÄ±zda teknik tartÄ±ÅŸmalara katÄ±labilirsiniz.
                        {% elif aday.seviye_sonuc == 'B1' %}
                        <strong>B1 - Orta:</strong> GÃ¼nlÃ¼k konularda kendinizi ifade edebilirsiniz.
                        {% elif aday.seviye_sonuc == 'A2' %}
                        <strong>A2 - Temel:</strong> Basit cÃ¼mlelerle iletiÅŸim kurabilirsiniz.
                        {% else %}
                        <strong>A1 - BaÅŸlangÄ±Ã§:</strong> Temel seviyede kelime ve ifadeler kullanabilirsiniz.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
