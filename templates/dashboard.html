{% extends "base.html" %}

{% block title %}Dashboard - Skills Test Center{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Stats Cards -->
    <div class="stats-row">
        <div class="stat-card blue">
            <div class="stat-icon">
                <span class="material-symbols-outlined">group</span>
            </div>
            <div class="stat-content">
                <h2>{{ stats.total_candidates or 0 }}</h2>
                <p>Toplam Aday</p>
            </div>
            <a href="{{ url_for('admin.adaylar') }}" class="stat-link">
                Adayları Görüntüle →
            </a>
        </div>

        <div class="stat-card green">
            <div class="stat-icon">
                <span class="material-symbols-outlined">help</span>
            </div>
            <div class="stat-content">
                <h2>{{ stats.total_questions or 0 }}</h2>
                <p>Toplam Soru</p>
            </div>
            <a href="{{ url_for('admin.sorular') }}" class="stat-link">
                Soruları Görüntüle →
            </a>
        </div>

        <div class="stat-card cyan">
            <div class="stat-icon">
                <span class="material-symbols-outlined">apartment</span>
            </div>
            <div class="stat-content">
                <h2>{{ company.isim if company else 'N/A' }}</h2>
                <p>Şirket</p>
            </div>
        </div>
    </div>

    <!-- Quick Actions - SADECE MEVCUT ROUTE'LAR -->
    <div class="quick-actions-section">
        <h5><span class="material-symbols-outlined">bolt</span> Hızlı İşlemler</h5>
        <div class="actions-grid">
            <a href="{{ url_for('admin.aday_ekle') }}" class="action-card">
                <span class="material-symbols-outlined">person_add</span>
                <span>Yeni Aday Ekle</span>
            </a>
            <a href="{{ url_for('admin.soru_ekle') }}" class="action-card">
                <span class="material-symbols-outlined">add_circle</span>
                <span>Yeni Soru Ekle</span>
            </a>
            <a href="{{ url_for('admin.kullanicilar') }}" class="action-card">
                <span class="material-symbols-outlined">manage_accounts</span>
                <span>Kullanıcılar</span>
            </a>
            <a href="{{ url_for('admin.ayarlar') }}" class="action-card">
                <span class="material-symbols-outlined">settings</span>
                <span>Ayarlar</span>
            </a>
        </div>
    </div>

    <!-- Recent Candidates -->
    <div class="recent-section">
        <h5><span class="material-symbols-outlined">history</span> Son Adaylar</h5>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Ad Soyad</th>
                        <th>Email</th>
                        <th>Giriş Kodu</th>
                        <th>Durum</th>
                        <th>Puan</th>
                        <th>İşlem</th>
                    </tr>
                </thead>
                <tbody>
                    {% for aday in recent_candidates %}
                    <tr>
                        <td>{{ aday.ad_soyad }}</td>
                        <td>{{ aday.email }}</td>
                        <td><code>{{ aday.giris_kodu }}</code></td>
                        <td>
                            {% if aday.sinav_durumu == 'tamamlandi' %}
                                <span class="badge bg-success">Tamamlandı</span>
                            {% elif aday.sinav_durumu == 'devam_ediyor' %}
                                <span class="badge bg-warning">Devam Ediyor</span>
                            {% else %}
                                <span class="badge bg-secondary">Beklemede</span>
                            {% endif %}
                        </td>
                        <td>{{ aday.toplam_puan or '-' }}</td>
                        <td>
                            <a href="{{ url_for('admin.aday_detay', id=aday.id) }}" class="btn btn-sm btn-outline-primary">
                                Detay
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">Henüz aday bulunmuyor.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Stats Summary -->
    <div class="summary-row">
        <div class="summary-card">
            <span class="material-symbols-outlined text-success">check_circle</span>
            <div>
                <h4>{{ stats.completed_exams or 0 }}</h4>
                <p>Tamamlanan</p>
            </div>
        </div>
        <div class="summary-card">
            <span class="material-symbols-outlined text-warning">pending</span>
            <div>
                <h4>{{ stats.pending_exams or 0 }}</h4>
                <p>Bekleyen</p>
            </div>
        </div>
        <div class="summary-card">
            <span class="material-symbols-outlined text-info">calendar_month</span>
            <div>
                <h4>{{ stats.exams_this_week or 0 }}</h4>
                <p>Bu Hafta</p>
            </div>
        </div>
    </div>
</div>

<style>
.dashboard-container { padding: 20px; max-width: 1400px; margin: 0 auto; }
.stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
.stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 24px; color: white; position: relative; }
.stat-card.blue { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.stat-card.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
.stat-card.cyan { background: linear-gradient(135deg, #00c6fb 0%, #005bea 100%); }
.stat-icon { position: absolute; top: 20px; left: 20px; }
.stat-icon .material-symbols-outlined { font-size: 48px; opacity: 0.3; }
.stat-content { text-align: right; }
.stat-content h2 { font-size: 2.5rem; font-weight: 700; margin: 0; }
.stat-content p { margin: 5px 0 0; opacity: 0.9; }
.stat-link { display: flex; align-items: center; justify-content: flex-end; gap: 5px; color: white; text-decoration: none; margin-top: 15px; opacity: 0.9; }
.stat-link:hover { opacity: 1; color: white; }
.quick-actions-section, .recent-section { background: white; border-radius: 16px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
.quick-actions-section h5, .recent-section h5 { display: flex; align-items: center; gap: 8px; margin-bottom: 20px; color: #333; }
.actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
.action-card { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border: 2px solid #e0e0e0; border-radius: 12px; text-decoration: none; color: #333; transition: all 0.2s; gap: 10px; }
.action-card:hover { border-color: #667eea; color: #667eea; transform: translateY(-2px); }
.action-card .material-symbols-outlined { font-size: 32px; }
.summary-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
.summary-card { background: white; border-radius: 12px; padding: 20px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
.summary-card .material-symbols-outlined { font-size: 40px; }
.summary-card h4 { margin: 0; font-size: 1.5rem; font-weight: 700; }
.summary-card p { margin: 0; color: #666; font-size: 0.9rem; }
</style>
{% endblock %}
